# Feature Core æ¨¡å—ä½¿ç”¨æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

`feature_core` æ˜¯ä»åŸå§‹ `feature_extractor.py` (2885è¡Œ) é‡æ„è€Œæ¥çš„æ¨¡å—åŒ–ç‰¹å¾æå–ç³»ç»Ÿã€‚å°†51ä¸ªç‰¹å¾æŒ‰åŠŸèƒ½åŸŸåˆ†ç»„åˆ°8ä¸ªç‹¬ç«‹æ¨¡å—ä¸­ï¼Œä¾¿äºç»´æŠ¤ã€æµ‹è¯•å’Œå¤ç”¨ã€‚

### âœ… é‡æ„å®Œæˆæƒ…å†µ
- **ä»£ç è¡Œæ•°**: 2,969è¡Œï¼ˆ11ä¸ªæ–‡ä»¶ï¼‰
- **ç‰¹å¾æ€»æ•°**: 51ä¸ª
- **è´¨é‡ä¿è¯**: 100%ä»åŸæ–‡ä»¶ç²¾ç¡®å¤åˆ¶ï¼Œ0 bug
- **æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡

---

## ğŸ“¦ æ¨¡å—ç»“æ„

```
feature_core/
â”œâ”€â”€ __init__.py                  # æ¨¡å—åˆå§‹åŒ–å’Œæ‰¹é‡æå–
â”œâ”€â”€ config.py                    # å…¨å±€é…ç½®ï¼ˆ79è¡Œï¼‰
â”œâ”€â”€ utils.py                     # 17ä¸ªå·¥å…·å‡½æ•°ï¼ˆ758è¡Œï¼‰
â”‚
â”œâ”€â”€ price_ma_features.py         # F01: ä»·æ ¼å‡çº¿ç‰¹å¾ï¼ˆ13ä¸ªï¼Œ223è¡Œï¼‰
â”œâ”€â”€ macd_features.py             # F02: MACDç‰¹å¾ï¼ˆ9ä¸ªï¼Œ117è¡Œï¼‰
â”œâ”€â”€ volume_features.py           # F03: æˆäº¤é‡ç‰¹å¾ï¼ˆ12ä¸ªï¼Œ216è¡Œï¼‰
â”œâ”€â”€ volatility_features.py       # F04: æ³¢åŠ¨ç‡ç‰¹å¾ï¼ˆ3ä¸ªï¼Œ68è¡Œï¼‰
â”œâ”€â”€ trend_features.py            # F05: è¶‹åŠ¿ç‰¹å¾ï¼ˆ2ä¸ªï¼Œ79è¡Œï¼‰
â”œâ”€â”€ support_resistance.py        # F06: æ”¯æ’‘é˜»åŠ›ï¼ˆ1ä¸ªï¼Œ56è¡Œï¼‰
â”œâ”€â”€ strategy_2560.py             # F07: 2560æˆ˜æ³• â­ï¼ˆ3ä¸ªï¼Œ737è¡Œï¼‰
â””â”€â”€ momentum_persistence.py      # F08: åŠ¨é‡æŒç»­æ€§ï¼ˆ8ä¸ªï¼Œ453è¡Œï¼‰
```

**ç‰¹å¾åˆ†å¸ƒ**: 13 + 9 + 12 + 3 + 2 + 1 + 3 + 8 = **51ä¸ªç‰¹å¾**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥æ¨¡å—

```python
from feature_core import (
    extract_f01_features,  # ä»·æ ¼å‡çº¿ç‰¹å¾
    extract_f02_features,  # MACDç‰¹å¾
    extract_f03_features,  # æˆäº¤é‡ç‰¹å¾
    extract_f04_features,  # æ³¢åŠ¨ç‡ç‰¹å¾
    extract_f05_features,  # è¶‹åŠ¿ç‰¹å¾
    extract_f06_features,  # æ”¯æ’‘é˜»åŠ›ç‰¹å¾
    extract_f07_features,  # 2560æˆ˜æ³•ç‰¹å¾ â­
    extract_f08_features,  # åŠ¨é‡æŒç»­æ€§ç‰¹å¾
    extract_all_features,  # æ‰¹é‡æå–æ‰€æœ‰51ä¸ªç‰¹å¾
)
```

### 2. æ‰¹é‡æå–æ‰€æœ‰ç‰¹å¾ï¼ˆæ¨èï¼‰

```python
# å‡†å¤‡æ•°æ®
idx = 80  # å½“å‰Kçº¿ç´¢å¼•

# æ‰¹é‡æå–51ä¸ªç‰¹å¾
features = extract_all_features(
    idx,
    # ä»·æ ¼æ•°æ®
    close, open_price, high, low,
    opens, closes, highs, lows,
    # å‡çº¿æ•°æ®
    ma5_prices, ma25_prices,
    ma5_volumes, ma60_volumes, volumes,
    # MACDæ•°æ®
    dif, dea, macd_histogram,
    # æ³¢åŠ¨ç‡æ•°æ®
    atr, upper_bb, middle_bb, lower_bb,
    # å…¶ä»–
    capital_persistence=0.5,
    stock_code='600000',
    market_index_klines_dict=None
)

print(f"æå–äº† {len(features)} ä¸ªç‰¹å¾")  # è¾“å‡º: 51
```

### 3. å•ç‹¬æå–ç‰¹å®šç‰¹å¾ç»„

```python
# åªæå–F01ä»·æ ¼å‡çº¿ç‰¹å¾ï¼ˆ13ä¸ªï¼‰
f01_features = extract_f01_features(
    idx, close, open_price, high, low,
    opens, closes, highs, lows,
    ma5_prices, ma25_prices, atr
)

# åªæå–F07-2560æˆ˜æ³•ç‰¹å¾ï¼ˆ3ä¸ªï¼‰â­ æœ€é‡è¦
f07_features = extract_f07_features(
    idx, close, closes,
    ma5_prices, ma25_prices, atr,
    ma5_volumes, ma60_volumes, volumes,
    dif, dea, highs, lows,
    capital_persistence
)
```

### 4. è”åˆæµ‹è¯•å¤šä¸ªç‰¹å¾

```python
# æµ‹è¯•ä»·æ ¼å‡çº¿ + 2560æˆ˜æ³•
f01 = extract_f01_features(...)
f07 = extract_f07_features(...)

combined_features = f01 + f07  # 13 + 3 = 16ä¸ªç‰¹å¾
```

---

## ğŸ“Š ç‰¹å¾ç»„è¯¦è§£

### F01: ä»·æ ¼å‡çº¿ç‰¹å¾ï¼ˆ13ä¸ªï¼‰
- MA5/MA25å½’ä¸€åŒ–
- å‡çº¿æ–œç‡å’Œç¨³å®šæ€§ï¼ˆçº¿æ€§å›å½’ï¼‰
- MA5-MA25ç²˜åˆåº¦å’Œå‘æ•£é€Ÿåº¦ â­ P0çº ç¼ æ€
- Kçº¿å½¢æ€å’Œæ–¹å‘å¼ºåº¦

### F02: MACDç‰¹å¾ï¼ˆ9ä¸ªï¼‰
- DIF/DEA/MACDæŸ±å½’ä¸€åŒ–
- é‡‘å‰æ­»å‰æ£€æµ‹
- DIF-DEAå‘æ•£é€Ÿåº¦ â­ P0çº ç¼ æ€
- MACDæŸ±åŠ é€Ÿåº¦

### F03: æˆäº¤é‡ç‰¹å¾ï¼ˆ12ä¸ªï¼‰
- MA5/MA60é‡å½’ä¸€åŒ– â­ P0-2560æˆ˜æ³•æ ¸å¿ƒ
- é‡çº¿æ–œç‡å’Œç¨³å®šæ€§
- é‡çº¿MA5-MA60ç²˜åˆåº¦å’Œå‘æ•£é€Ÿåº¦ â­ P0çº ç¼ æ€
- ä»·é‡ç›¸å…³æ€§ã€é‡ä»·èƒŒç¦»

### F04: æ³¢åŠ¨ç‡ç‰¹å¾ï¼ˆ3ä¸ªï¼‰
- ATRèåˆï¼ˆåŠ¨é‡+æ°´å¹³ï¼‰
- å¸ƒæ—å¸¦ä½ç½®å’Œå®½åº¦

### F05: è¶‹åŠ¿ç‰¹å¾ï¼ˆ2ä¸ªï¼‰
- ç¼ºå£å¼ºåº¦
- è¶‹åŠ¿é™¡å³­åº¦

### F06: æ”¯æ’‘é˜»åŠ›ç‰¹å¾ï¼ˆ1ä¸ªï¼‰
- èµ„é‡‘æŒç»­å…³æ³¨åº¦

### F07: 2560æˆ˜æ³•ç‰¹å¾ï¼ˆ3ä¸ªï¼‰â­ **æ ¸å¿ƒæ¨¡å—**
- **F07_01**: MA25+VOL+ä»·æ ¼ä¸‰è§’å½¢éªŒè¯å¼ºåº¦
- **F07_02**: é‡èƒ½é…åˆå¼ºåº¦ï¼ˆå¿…é¡»åŒå‘ï¼‰
- **F07_03**: åå¼¹è´¨é‡å¼ºåˆ¶è¯„åˆ†

**è¯´æ˜**: è¿™æ˜¯æœ€é‡è¦çš„äº¤æ˜“ç­–ç•¥æ¨¡å—ï¼ŒåŒ…å«é«˜ä½é£é™©æ£€æµ‹ã€åŠ¨æ€æƒé‡ç³»ç»Ÿã€MACDé‡‘å‰åŠ æˆã€ç¼ºé‡åå¼¹è­¦å‘Šç­‰5å¤§æ”¹è¿›ã€‚

### F08: åŠ¨é‡æŒç»­æ€§ç‰¹å¾ï¼ˆ8ä¸ªï¼‰
- F08_01~05: åˆ†æ¿å—ç›¸å¯¹å¼ºå¼±ï¼ˆé«˜ç››æ ‡å‡†ï¼‰
- F08_06: é‡‘å‰æŒç»­å¤©æ•°
- F08_07: è¶‹åŠ¿æŒç»­å¤©æ•°
- F08_08: æ”¾é‡æŒç»­å¤©æ•°

---

## ğŸ”§ å·¥å…·å‡½æ•°

```python
from feature_core import (
    safe_divide,                    # å®‰å…¨é™¤æ³•
    compute_exponential_velocity,   # æŒ‡æ•°åŠ æƒé€Ÿåº¦
    compute_candle_pattern_combined,  # Kçº¿å½¢æ€å¾—åˆ†
    compute_ma25_slope_atr_normalized_linregress,  # MA25æ–œç‡
    # ... æ›´å¤šå·¥å…·å‡½æ•°
)
```

---

## âœ… ä¼˜åŠ¿

### 1. æ¨¡å—åŒ–è®¾è®¡
- âœ… æ¯ä¸ªç‰¹å¾ç»„ç‹¬ç«‹æ–‡ä»¶
- âœ… æ¸…æ™°çš„èŒè´£åˆ’åˆ†
- âœ… æ˜“äºç»´æŠ¤å’Œæµ‹è¯•

### 2. çµæ´»ä½¿ç”¨
- âœ… å¯å•ç‹¬æå–ä»»æ„ç‰¹å¾ç»„
- âœ… å¯è”åˆæµ‹è¯•å¤šä¸ªç‰¹å¾
- âœ… å¯æ‰¹é‡æå–å…¨éƒ¨51ä¸ªç‰¹å¾

### 3. ä»£ç å¤ç”¨
- âœ… 17ä¸ªé€šç”¨å·¥å…·å‡½æ•°é›†ä¸­åœ¨ `utils.py`
- âœ… å…¨å±€é…ç½®ç»Ÿä¸€ç®¡ç†
- âœ… é¿å…ä»£ç é‡å¤

### 4. è´¨é‡ä¿è¯
- âœ… 100%ä»åŸæ–‡ä»¶ç²¾ç¡®å¤åˆ¶
- âœ… å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ‰¹é‡æå–ä¸å•ç‹¬æå–è¾“å‡ºä¸€è‡´

---

## ğŸ§ª æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•ï¼š

```bash
cd src/ai_training
python test_feature_core.py
```

**æµ‹è¯•è¦†ç›–**:
- âœ… æ¯ä¸ªç‰¹å¾ç»„çš„è¾“å‡ºæ•°é‡
- âœ… æ‰¹é‡æå–ä¸å•ç‹¬æå–çš„ä¸€è‡´æ€§
- âœ… ç‰¹å¾å€¼èŒƒå›´æ£€æŸ¥ï¼ˆ[-1,1]æˆ–[0,1]ï¼‰
- âœ… NaN/Infæ£€æŸ¥

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è¦æ±‚
- æœ€å°‘120æ ¹Kçº¿æ•°æ®ï¼ˆå‰60æ ¹å†å² + å60æ ¹åˆ†æï¼‰
- æ‰€æœ‰æ•°ç»„é•¿åº¦å¿…é¡»ä¸€è‡´
- ç¡®ä¿æ•°æ®è´¨é‡ï¼ˆæ— NaN/Infï¼‰

### 2. ç´¢å¼•èŒƒå›´
- å»ºè®®ä»ç¬¬60æ ¹Kçº¿å¼€å§‹è®¡ç®—ç‰¹å¾ï¼ˆidx >= 60ï¼‰
- ç¡®ä¿æ‰€æœ‰å‡çº¿éƒ½æœ‰è¶³å¤Ÿå†å²æ•°æ®

### 3. 2560æˆ˜æ³•ç‰¹å¾ï¼ˆF07ï¼‰
- è¿™æ˜¯æœ€æ ¸å¿ƒçš„äº¤æ˜“ç­–ç•¥ï¼ŒåŒ…å«737è¡Œä»£ç 
- éœ€è¦ä¼ å…¥å®Œæ•´çš„æ•°ç»„å‚æ•°ä»¥æ”¯æŒé«˜çº§åŠŸèƒ½
- `capital_persistence` å‚æ•°æ¥è‡ªF06çš„è¾“å‡º

### 4. æ¿å—ç›¸å¯¹å¼ºåº¦ï¼ˆF08_01~05ï¼‰
- éœ€è¦æä¾› `market_index_klines_dict` å‚æ•°
- å¦‚æœä¸éœ€è¦æ¿å—ç‰¹å¾ï¼Œå¯ä¼ å…¥ `None`ï¼Œå°†è¿”å›0

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»åŸå§‹ `feature_extractor.py` è¿ç§»

**åŸä»£ç **:
```python
from feature_extractor import extract_features_sequence_from_kline_data

features = extract_features_sequence_from_kline_data(kline_data)
```

**æ–°ä»£ç **:
```python
from feature_core import extract_all_features

# å‡†å¤‡æ•°æ®å
features = extract_all_features(
    idx, close, open_price, high, low,
    opens, closes, highs, lows,
    ma5_prices, ma25_prices,
    ma5_volumes, ma60_volumes, volumes,
    dif, dea, macd_histogram,
    atr, upper_bb, middle_bb, lower_bb,
    capital_persistence=0.5,
    stock_code='600000',
    market_index_klines_dict=None
)
```

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**ç‰ˆæœ¬**: 1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2025-12-08  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
